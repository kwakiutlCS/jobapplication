<ui:composition template="/resources/layouts/managerTemplate.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="scripts">
		<h:outputStylesheet library="css" name="interviews.css" />
		<h:outputScript library="js" name="positions.js" />
	</ui:define>
	
	<ui:define name="title">List Position</ui:define>

	<ui:define name="content">

		<h:panelGroup id="filterAction">
			<h:form prependId="false">
				<p:selectOneMenu id="filterSelector" onchange="changeSelector(this)">
					<f:selectItem itemValue="keywordFilter" itemLabel="keyword" />
					<f:selectItem itemValue="codeFilter" itemLabel="code" />
					<f:selectItem itemValue="titleFilter" itemLabel="title" />
					<f:selectItem itemValue="stateFilter" itemLabel="state" />
					<f:selectItem itemValue="localizationFilter" itemLabel="localization" />
					<f:selectItem itemValue="areaFilter" itemLabel="technical area" />
					<f:selectItem itemValue="companyFilter" itemLabel="company" />
					<f:selectItem itemValue="dateFilter" itemLabel="date" />
				</p:selectOneMenu>
			</h:form>
			
			<h:panelGroup id="keywordFilter" class="filter">
			<h:form>
				<p:inputText value="#{listPositionBean.keyword}" required="true" />
				<p:commandButton value="Add Keyword" action="#{listPositionBean.addKeyword}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="codeFilter" class="filter">
			<h:form>
				<p:spinner value="#{listPositionBean.code}" required="true" min="1" />
				<p:commandButton value="Add Code" action="#{listPositionBean.addCode}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="titleFilter" class="filter">
			<h:form>
				<p:inputText value="#{listPositionBean.title}" required="true" />
				<p:commandButton value="Add Title" action="#{listPositionBean.addTitle}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="stateFilter" class="filter">
			<h:form>
				<p:selectOneMenu value="#{listPositionBean.state}" 
				converter="omnifaces.SelectItemsConverter">
					<f:selectItems value="#{positionBean.positionStates}" var="state" 
					itemLabel="#{state.positionStateLabel}" />
				</p:selectOneMenu>
				<p:commandButton value="Add State" action="#{listPositionBean.addState}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="localizationFilter" class="filter">
			<h:form>
				<p:selectOneMenu value="#{listPositionBean.localization}"
				converter="omnifaces.SelectItemsConverter" styleClass="selectMenu">
					<f:selectItems value="#{positionBean.localizations}"
						var="local" itemLabel="#{local.localizationLabel}" />
				</p:selectOneMenu>

				<p:commandButton value="Add Localization" action="#{listPositionBean.addLocalizationToFilter}"
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="areaFilter" class="filter">
			<h:form>
				<p:selectOneMenu value="#{listPositionBean.area}"
				converter="omnifaces.SelectItemsConverter" styleClass="selectMenu">
					<f:selectItems value="#{positionBean.technicalAreas}"
						var="area" itemLabel="#{area.technicalAreaLabel}" />
				</p:selectOneMenu>

				<p:commandButton value="Add Technical Area" action="#{listPositionBean.addAreaToFilter}"
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="companyFilter" class="filter">
			<h:form>
				<p:inputText value="#{listPositionBean.company}" required="true" />
				<p:commandButton value="Add Company" action="#{listPositionBean.addCompany}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="dateFilter" class="filter">
			<h:form>
				<p:outputLabel for="startDate" value="Start date" />
				<p:calendar id="startDate" value="#{listPositionBean.startDate}" 
				locale="pt" pattern="dd/MM/yyyy" timeZone="GMT" />
				<br />
				<p:outputLabel for="finishDate" value="End date" />
				<p:calendar id="finishDate" value="#{listPositionBean.finishDate}" 
				locale="pt" pattern="dd/MM/yyyy" timeZone="GMT" />
				<p:commandButton value="Add Date" action="#{listPositionBean.addDateFilter}" 
				update=":positionsTable :filterList" />
			</h:form>
			</h:panelGroup>
		</h:panelGroup>
		
		
		
		
		<h:panelGroup id="filterList">
			
			<h:panelGroup id="keyword">
				<h:form>
					<ui:repeat value="#{listPositionBean.keywordSets}" var="key"
						varStatus="status">
						<span class="filterUnit"> <h:outputText value="#{key}" />
							<p:commandLink value="x" styleClass="removalLink"
								action="#{listPositionBean.deleteKeyword(status.index)}"
								update=":filterList :positionsTable" />
						</span>
						<h:outputText value="or" rendered="#{not status.last}" />
					</ui:repeat>
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{listPositionBean.filter.code gt 0}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{listPositionBean.filter.code}" />
					<p:commandLink value="x" action="#{listPositionBean.removeCode}" 
					update=":positionsTable :filterList" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>

			<h:panelGroup id="title">
				<h:form>
					<ui:repeat value="#{listPositionBean.titleSets}" var="title"
						varStatus="status">
						<span class="filterUnit"> <h:outputText value="#{title}" />
							<p:commandLink value="x" styleClass="removalLink"
								action="#{listPositionBean.deleteTitle(status.index)}"
								update=":filterList :positionsTable" />
						</span>
						<h:outputText value="or" rendered="#{not status.last}" />
					</ui:repeat>
				</h:form>
			</h:panelGroup>

			<h:panelGroup rendered="#{not empty listPositionBean.filter.state}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{listPositionBean.filter.state.positionStateLabel}" />
					<p:commandLink value="x" action="#{listPositionBean.removeState}" 
					update=":positionsTable :filterList" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup id="technicalAreas">
				<h:form>
					<ui:repeat value="#{listPositionBean.areaSet}" var="set"
						varStatus="status">
						<span class="filterUnit"> <ui:repeat value="#{set}"
								var="area" varStatus="innerStatus">
								<h:outputText value="#{area.technicalAreaLabel}" />
								<p:commandLink value="x" styleClass="removalLink"
									action="#{listPositionBean.deleteArea(status.index, innerStatus.index)}"
									update="@form :positionsTable" />
								<p:commandLink value="and" rendered="#{not innerStatus.last}"
									update="@form :positionsTable"
									action="#{listPositionBean.splitAreas(status.index, innerStatus.index)}"
									styleClass="conjugationLink" />
							</ui:repeat>
						</span>
						<p:commandLink value="or" rendered="#{not status.last}"
							update="@form :positionsTable"
							action="#{listPositionBean.mergeAreas(status.index)}"
							styleClass="conjugationLink" />
					</ui:repeat>
				</h:form>
			</h:panelGroup>

			<h:panelGroup id="localizations">
				<h:form>
					<ui:repeat value="#{listPositionBean.localizationSet}" var="set"
						varStatus="status">
						<span class="filterUnit"> <ui:repeat value="#{set}"
								var="local" varStatus="innerStatus">
								<h:outputText value="#{local.localizationLabel}" />
								<p:commandLink value="x" styleClass="removalLink"
									action="#{listPositionBean.deleteLocalization(status.index, innerStatus.index)}"
									update="@form :positionsTable" />
								<p:commandLink value="and" rendered="#{not innerStatus.last}"
									update="@form :positionsTable"
									action="#{listPositionBean.splitLocalizations(status.index, innerStatus.index)}"
									styleClass="conjugationLink" />
							</ui:repeat>
						</span>
						<p:commandLink value="or" rendered="#{not status.last}"
							update="@form :positionsTable"
							action="#{listPositionBean.mergeLocalizations(status.index)}"
							styleClass="conjugationLink" />
					</ui:repeat>
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{not empty listPositionBean.filter.company}" 
				styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{listPositionBean.filter.company}" />
					<p:commandLink value="x" action="#{listPositionBean.removeCompany}" 
					update=":positionsTable :filterList" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>

			<h:panelGroup styleClass="filterUnit"
				rendered="#{not empty listPositionBean.filter.startDate or 
							not empty listPositionBean.filter.finishDate}">
				<h:form style="display:inline-block">
					<h:outputText value="#{listPositionBean.filter.startDate}" converter="dateConverter">
					</h:outputText>
					<p:commandLink value="x" rendered="#{not empty listPositionBean.filter.startDate}"
						action="#{listPositionBean.removeStartDate}"
						update=":positionsTable :filterList :filterAction" styleClass="removalLink" />
					-
					<h:outputText value="#{listPositionBean.filter.finishDate}" converter="dateConverter">
					</h:outputText>
					<p:commandLink value="x" rendered="#{not empty listPositionBean.filter.finishDate}"
						action="#{listPositionBean.removeFinishDate}"
						update=":positionsTable :filterList :filterAction" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
		</h:panelGroup>




		<p:dataTable var="position" value="#{listPositionBean.positionsByManager}" id="positionsTable"
				widgetVar="positionsTable"
				emptymessage="No positions found for given criteria"
				style="text-align: center">

				<p:column headerText="Closing date">
					<h:outputText value="#{position.closingDateFormatted}" />
				</p:column>

				<p:column headerText="Code">
					<h:outputText value="#{position.code}" />
				</p:column>

				<p:column headerText="Title">
					<h:outputText value="#{position.title}" />
				</p:column>

				<p:column headerText="Situation">
					<h:outputText value="#{position.state.positionStateLabel}" />
				</p:column>


				<p:column headerText="Location">
					<ui:repeat value="#{position.localizationsFormatted}" var="l">
  						    #{l}
					</ui:repeat>
				</p:column>

				<p:column headerText="Technical Area" style="width:200px">
					<ui:repeat value="#{position.technicalAreasFormatted}" var="t">
  						    #{t}
					</ui:repeat>
				</p:column>

				<p:column headerText="Company">
					<h:outputText value="#{position.company}" />
				</p:column>

				<p:column headerText="Detail" style="width:32px;text-align: center">
					<p:commandButton update=":positionDetail"
						oncomplete="PF('Dlg1').show()" icon="ui-icon-search" title="View">
						<f:setPropertyActionListener value="#{position}"
							target="#{listPositionBean.selectedPosition}" />
					</p:commandButton>
				</p:column>

			</p:dataTable>

			<p:dialog header="Edit Position" widgetVar="Dlg1" modal="true"
			showEffect="fade" hideEffect="fade" resizable="true"
			minimizable="true" maximizable="true">
			<p:outputPanel id="positionDetail" style="text-align:left;">
				<h:form>

					<p:panelGrid columns="2"
						rendered="#{not empty listPositionBean.selectedPosition}"
						columnClasses="label,value">

						
						<h:outputText value="Non editable fields" />
						<h:outputText value="" />
					
						<h:outputText value="Opening date:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.openingDateFormatted}" />

						<h:outputText value="Code:" />
						<h:outputText value="#{listPositionBean.selectedPosition.code}" />

						<h:outputText value="Closing date:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.closingDateFormatted}" />

						<h:outputText value="SLA (days):" />
						<h:outputText value="#{listPositionBean.selectedPosition.sla}" />

						<h:outputText value="Company" />
						<h:outputText value="#{listPositionBean.selectedPosition.company}" />

						<h:outputText value="Technical Area" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.technicalAreasFormatted}" />

								<h:outputText value="Editable fields" />
						<h:outputText value="" />

						<h:outputText value="Title:" />
						<p:inplace>
							<p:inputText value="#{listPositionBean.selectedPosition.title}" />
						</p:inplace>

						<h:outputText value="Location:" />
						<p:selectManyCheckbox id="local"
							value="#{listPositionBean.selectedPosition.localizations}"
							converter="localizationConverter">
							<f:selectItems value="#{positionBean.localizations}"
								var="localization" itemValue="#{localization}"
								itemLabel="#{localization.localizationLabel}" />
						</p:selectManyCheckbox>

						<h:outputText value="Situation:" />
						<p:selectOneMenu id="editState"
							value="#{listPositionBean.selectedPosition.state}">
							<f:selectItems value="#{positionBean.positionStates}"
								var="positionState" itemValue="#{positionState}"
								itemLabel="#{positionState.positionStateLabel}" />
						</p:selectOneMenu>

						<h:outputText value="Vacancies:" />
						<p:inplace>
							<p:inputText
								value="#{listPositionBean.selectedPosition.vacancies}" />
						</p:inplace>

						<h:outputText value="Contact person:" />
						<p:inplace>
							<p:inputText
								value="#{listPositionBean.selectedPosition.contactPerson}" />
						</p:inplace>

						<h:outputText value="Description" />
						<p:inputTextarea
							value="#{listPositionBean.selectedPosition.description}" />

						<h:outputText value="Publication channels" />
						<p:selectManyCheckbox id="chan"
							value="#{listPositionBean.selectedPosition.IPublicationChannels}"
							converter="omnifaces.SelectItemsConverter">
							<f:selectItems
								value="#{publicationChannelBean.iPublicationChannels}"
								var="channel" itemValue="#{channel}"
								itemLabel="#{channel.channel}" />
						</p:selectManyCheckbox>

						<p:commandButton value="Save changes"
							actionListener="#{listPositionBean.updatePosition(listPositionBean.selectedPosition)}"
							styleClass="ui-priority-primary" />

						<p:commandButton value="Exit" onclick="positionDetail.hide()" />
					</p:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:dialog>
	</ui:define>
</ui:composition>