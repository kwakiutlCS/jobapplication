<ui:composition template="/resources/layouts/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">

	<ui:define name="title">Job Applications</ui:define>
	
	<ui:define name="scripts">
		<h:outputStylesheet library="css" name="interviews.css" />
		<h:outputScript library="js" name="applications.js" />
	</ui:define>
	
	<ui:define name="content">
		<p>
		Esta página é para ser alterada. Da minha parte só preciso de um link em cada entrada da candidatura
		para os detalhes da candidatura
		o link já está feito (só é visível se houver applications na db, claro)
		</p>
		
		<h:panelGroup id="preFilterSection">		
			<h:form prependId="false">
				<p:selectOneMenu id="filterSelector" onchange="changeSelector(this)">
					<f:selectItem itemValue="codeFilter" itemLabel="code" />
					<f:selectItem itemValue="candidateFilter" itemLabel="candidate" />
					<f:selectItem itemValue="stateFilter" itemLabel="state" />
					<f:selectItem itemValue="typeFilter" itemLabel="type" />
					<f:selectItem itemValue="dateFilter" itemLabel="date" />
				</p:selectOneMenu>
			</h:form>
			
			<h:form class="filter" id="codeFilter">
				<p:inputText value="#{applicationBean.code}" required="true" />
				<p:commandButton value="Add Code" action="#{applicationBean.addCode}" 
				update=":filterSection :filteredList" />
			</h:form>
			
			<h:form class="filter" id="candidateFilter">
				<p:inputText value="#{applicationBean.candidate}" required="true" />
				<p:commandButton value="Add Candidate" action="#{applicationBean.addCandidate}" 
				update=":filterSection :filteredList" />
			</h:form>
			
			<h:form class="filter" id="stateFilter">
				<p:selectOneMenu value="#{applicationBean.state}" 
				converter="omnifaces.SelectItemsConverter">
					<f:selectItems value="#{positionBean.positionStates}" var="state" 
					itemLabel="#{state.positionStateLabel}" />
				</p:selectOneMenu>
				<p:commandButton value="Add State" action="#{applicationBean.addState}" 
				update=":filterSection :filteredList" />
			</h:form>
			
			<h:form class="filter" id="typeFilter">
				<p:selectOneMenu value="#{applicationBean.type}">
					<f:selectItem itemValue="External" itemLabel="External" />
					<f:selectItem itemValue="Internal" itemLabel="Internal" />
				</p:selectOneMenu>
				<p:commandButton value="Add Type" action="#{applicationBean.addType}" 
				update=":filterSection :filteredList" />
			</h:form>
			
			<h:form class="filter" id="dateFilter">
				<p:outputLabel for="startDate" value="Start date" />
				<p:calendar id="startDate" value="#{applicationBean.startDate}" 
				locale="pt" pattern="dd/MM/yyyy" timeZone="GMT" />
				<br />
				<p:outputLabel for="finishDate" value="End date" />
				<p:calendar id="finishDate" value="#{applicationBean.endDate}" 
				locale="pt" pattern="dd/MM/yyyy" timeZone="GMT" />
				<p:commandButton value="Add Date" action="#{applicationBean.addDateFilter}" 
				update=":filterSection :filteredList" />
			</h:form>
			
		</h:panelGroup>
		
		<h:panelGroup id="filterSection">
		
			<h:panelGroup rendered="#{not empty applicationBean.filter.code}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{applicationBean.filter.code}" />
					<p:commandLink value="x" action="#{applicationBean.removeCode}" 
					update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{not empty applicationBean.filter.candidate}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{applicationBean.filter.candidate}" />
					<p:commandLink value="x" action="#{applicationBean.removeCandidate}" 
					update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{not empty applicationBean.filter.state}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{applicationBean.filter.state.positionStateLabel}" />
					<p:commandLink value="x" action="#{applicationBean.removeState}" 
					update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{not empty applicationBean.filter.type}" 
			styleClass="filterUnit">
				<h:form style="display:inline-block">
					<h:outputText value="#{applicationBean.filter.type}" />
					<p:commandLink value="x" action="#{applicationBean.removeType}" 
					update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
			
			<h:panelGroup styleClass="filterUnit"
				rendered="#{not empty applicationBean.filter.startDate or 
							not empty applicationBean.filter.finishDate}">
				<h:form style="display:inline-block">
					<h:outputText value="#{applicationBean.filter.startDate}" converter="dateConverter">
					</h:outputText>
					<p:commandLink value="x" rendered="#{not empty applicationBean.filter.startDate}"
						action="#{applicationBean.removeStartDate}"
						update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
					-
					<h:outputText value="#{applicationBean.filter.finishDate}" converter="dateConverter">
					</h:outputText>
					<p:commandLink value="x" rendered="#{not empty applicationBean.filter.finishDate}"
						action="#{applicationBean.removeFinishDate}"
						update=":filterSection :filteredList :preFilterSection" styleClass="removalLink" />
				</h:form>
			</h:panelGroup>
		</h:panelGroup>
		
		
		<p:dataTable value="#{applicationBean.activeApplications}" var="app" id="filteredList">
			<p:column>#{app.date}</p:column>
			<p:column>#{app.position.code}</p:column>
			<p:column>#{app.position.stateFormatted}</p:column>
			<p:column>#{app.candidate.fullName}</p:column>
			<p:column><p:link outcome="application.xthml?ap=#{app.id}" value="detail" /></p:column>
		</p:dataTable>

	</ui:define>
</ui:composition>

