<ui:composition template="/resources/layouts/template.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui">


	<ui:define name="title">Index</ui:define>

	<ui:define name="content">

		<h:form id="listPositionForm">

			<p:dataTable var="position" value="#{listPositionBean.positions}"
				widgetVar="positionsTable"
				emptymessage="No positions found for given criteria"
				filteredValue="#{listPositionBean.filteredPositions}"
				style="text-align: center">

				<f:facet name="header">
					<p:outputPanel>
						<h:outputText value="Open Positions" />
					</p:outputPanel>
				</f:facet>

				<p:column headerText="Closing date">
					<h:outputText value="#{position.closingDateFormatted}" />
				</p:column>

				<p:column headerText="Code">
					<h:outputText value="#{position.code}" />
				</p:column>

				<p:column headerText="Title">
					<h:outputText value="#{position.title}" />
				</p:column>

				<p:column headerText="Location">
					<ui:repeat value="#{position.localizationsFormatted}" var="l">
  						    #{l}
					</ui:repeat>
				</p:column>

				<p:column headerText="Technical Area">
					<ui:repeat value="#{position.technicalAreasFormatted}" var="t">
  						    #{t}
					</ui:repeat>
				</p:column>

				<p:column headerText="Company">
					<h:outputText value="#{position.company}" />
				</p:column>

				<p:column headerText="Detail" style="width:32px;text-align: center">
					<p:commandButton update=":listPositionForm :positionDetailForm"
						oncomplete="PF('positionDetailDlg').show()" icon="ui-icon-search"
						title="View">
						<f:setPropertyActionListener value="#{position}"
							target="#{listPositionBean.selectedPosition}" />
					</p:commandButton>
				</p:column>

			</p:dataTable>

		</h:form>

		<p:dialog header="Position Detail" widgetVar="positionDetailDlg"
			modal="true" resizable="true" minimizable="true" maximizable="true">
			<p:outputPanel id="positionDetailPanel" style="text-align:left;">
				<h:form id="positionDetailForm">

					<p:panelGrid columns="2"
						rendered="#{not empty listPositionBean.selectedPosition}"
						columnClasses="label,value">

						<h:outputText value="Title:" />
						<h:outputText value="#{listPositionBean.selectedPosition.title}" />

						<h:outputText value="Opening date:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.openingDateFormatted}" />

						<h:outputText value="Code:" />
						<h:outputText value="#{listPositionBean.selectedPosition.code}" />

						<h:outputText value="Closing date:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.closingDateFormatted}" />

						<h:outputText value="Company" />
						<h:outputText value="#{listPositionBean.selectedPosition.company}" />

						<h:outputText value="Technical Area" />
						<p:column headerText="Technical Area">
							<ui:repeat
								value="#{listPositionBean.selectedPosition.technicalAreasFormatted}"
								var="t">
  						  		  #{t}
							</ui:repeat>
						</p:column>

						<h:outputText value="Location:" />
						<p:column headerText="Location">
							<ui:repeat
								value="#{listPositionBean.selectedPosition.localizationsFormatted}"
								var="l">
  							    #{l}
							</ui:repeat>
						</p:column>

						<h:outputText value="Situation:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.stateFormatted}" />

						<h:outputText value="Vacancies:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.vacancies}" />

						<h:outputText value="Contact person:" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.contactPerson}" />

						<h:outputText value="Description" />
						<h:outputText
							value="#{listPositionBean.selectedPosition.description}" />

						<h:outputText value="Publication channels" />
						<p:column headerText="Publication Channels">
							<ui:repeat
								value="#{listPositionBean.selectedPosition.publicationChannels}"
								var="l">
  							    #{l}
							</ui:repeat>
						</p:column>

						<p:column>
							<p:commandButton
								update=":listPositionForm :positionDetailForm :applyForm"
								value="Apply Now" actionListener="#{viewManager.swapDialog()}">
								<f:setPropertyActionListener value="#{position}"
									target="#{applicationBean.position}" />
							</p:commandButton>
							<p:commandButton value="Exit" onclick="positionDetailDlg.hide()" />
						</p:column>

					</p:panelGrid>
				</h:form>
			</p:outputPanel>
		</p:dialog>

		<p:dialog header="Application" widgetVar="applyDlg" modal="true"
			showEffect="fade" hideEffect="fade" resizable="true"
			minimizable="true" maximizable="true">
			<p:outputPanel id="applyPanel" style="text-align:left;">
				<h:form id="applyForm">
					<h:outputText value="YouÂ´re applying to position " />
					<h:outputText value="#{listPositionBean.selectedPosition.title}" />
					<p></p>
				</h:form>


				<h:form>
					<p:fieldset legend="Personal Details" toggleable="true"
						toggleSpeed="500">
						<h:panelGrid columns="2">

							<p:outputLabel value="Email" />
							<p:inputText id="email" value="#{registerBean.email}" />

							<p:outputLabel value="First name" for="name" />
							<p:inputText id="name" value="#{registerBean.name}" />

							<p:outputLabel value="Surname" />
							<p:inputText id="surname" value="#{registerBean.surname}" />

						</h:panelGrid>

						<p:commandButton value="Save changes"
							actionListener="#{registerBean.updateCandidate()}" />
					</p:fieldset>
				</h:form>


				<h:form>
					<p:fieldset legend="Contact Details" toggleable="true"
						toggleSpeed="500">
						<h:panelGrid columns="2">

							<p:outputLabel value="Address" for="address" />
							<p:inputText id="address" value="#{registerBean.address}" />

							<p:outputLabel value="City" for="city" />
							<p:inputText id="city" value="#{registerBean.city}" />

							<p:outputLabel value="Country" for="country" />
							<p:inputText id="country" value="#{registerBean.country}" />

							<p:outputLabel value="Phone number" for="phone" />
							<p:inputMask mask="999 999 999" id="phone"
								value="#{registerBean.phone}" />

							<p:outputLabel value="Mobile number" for="mobile" />
							<p:inputMask mask="999 999 999" id="mobile"
								value="#{registerBean.mobilePhone}" />

						</h:panelGrid>

						<p:commandButton value="Submit"
							actionListener="#{registerBean.updateCandidate()}" />
					</p:fieldset>
				</h:form>



				<h:form>
					<p:fieldset legend="Qualifications" toggleable="true"
						toggleSpeed="500">
						<p:messages />
						<h:panelGrid columns="1">

							<h:panelGroup id="qualificationsList">
								<ui:repeat value="#{loginBean.user.qualifications}"
									var="qualification">
									<div>
										<div>#{qualification.school}</div>
										<div>#{qualification.degree}</div>
										<div>
											<p:commandLink value="delete" update="@form"
												action="#{registerBean.removeQualification(qualification)}" />
										</div>
									</div>
								</ui:repeat>

							</h:panelGroup>
							<p></p>
							<p:outputLabel for="institution" value="Institution" />
							<p></p>
							<p:autoComplete id="institution"
								value="#{registerBean.qualification}" forceSelection="false"
								completeMethod="#{registerBean.listSchools}" style="width:600px"
								maxResults="8">
							</p:autoComplete>

							<p></p>
							<p:outputLabel for="degreeField" value="Course" />
							<p:autoComplete id="degreeField" style="width:600px"
								value="#{registerBean.degree}"
								completeMethod="#{registerBean.listDegrees()}" maxResults="8" />
							<p></p>
							<p:commandButton value="Add qualification"
								action="#{registerBean.addQualification}" update="@form" />

						</h:panelGrid>

						<p:commandButton value="Save changes"
							actionListener="#{registerBean.updateCandidate()}" />
					</p:fieldset>
				</h:form>

				<h:form>
					<p:fieldset legend="Cover Letter" toggleable="true"
						toggleSpeed="500">
						<p:editor id="editor" widgetVar="editorWidget"
							value="#{applicationBean.coverLetter}" width="600" />

						<h:panelGrid columns="2" style="margin-top: 10px">
							<p:commandButton value="Submit" update="display"
								oncomplete="PF('letterDlg').show()" icon="ui-icon-disk" />

							<p:commandButton value="Clear" type="button"
								onclick="PF('editorWidget').clear();" icon="ui-icon-close" />
						</h:panelGrid>

						<p:dialog header="Cover Letter Preview" widgetVar="letterDlg"
							showEffect="fade" hideEffect="fade">
							<h:outputText id="display" value="#{applicationBean.coverLetter}"
								escape="false" />
						</p:dialog>
					</p:fieldset>
				</h:form>


				<h:form enctype="multipart/form-data" type="file">
					<p:fieldset legend="Curriculum Vitae" toggleable="true"
						toggleSpeed="500">
						<p:messages />
						<h:panelGrid columns="1">
							<h:inputFile value="#{registerBean.cv}" required="true"
								id="fileUploader">
								<f:ajax listener="#{registerBean.upload}"
									render=":globalMessages" />
							</h:inputFile>

						</h:panelGrid>
						<p></p>
						<p:commandButton value="Send"
							actionListener="#{registerBean.updateCandidate()}" />
					</p:fieldset>
				</h:form>

			</p:outputPanel>

		</p:dialog>

	</ui:define>
</ui:composition>
